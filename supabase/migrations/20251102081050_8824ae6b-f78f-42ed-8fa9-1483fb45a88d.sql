-- Create genres table for dynamic genre management
CREATE TABLE IF NOT EXISTS public.genres (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL UNIQUE,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now()
);

-- Enable RLS
ALTER TABLE public.genres ENABLE ROW LEVEL SECURITY;

-- RLS Policies
CREATE POLICY "Anyone can view genres"
  ON public.genres
  FOR SELECT
  USING (true);

CREATE POLICY "Authenticated users can insert genres"
  ON public.genres
  FOR INSERT
  WITH CHECK (auth.uid() IS NOT NULL);

-- Insert existing genres from the hardcoded list
INSERT INTO public.genres (name) VALUES
  ('أكشن'), ('مغامرة'), ('كوميدي'), ('دراما'), ('فانتازيا'),
  ('رعب'), ('رومانسي'), ('خيال علمي'), ('إثارة'), ('غموض'),
  ('مدرسي'), ('رياضة'), ('شريحة من الحياة'), ('خارق للطبيعة'),
  ('نفسي'), ('تاريخي'), ('سحر'), ('ميكا'), ('شونين'), ('شوجو'),
  ('فنون قتالية'), ('سيف'), ('سامراي'), ('نينجا'), ('قتال'),
  ('معارك'), ('حرب'), ('عسكري'), ('قوى خارقة'), ('أبطال خارقون'),
  ('عالم آخر'), ('سفر عبر الزمن'), ('نقل إلى عالم آخر'),
  ('تناسخ'), ('بوابات'), ('أبراج محصنة'), ('صيادين'),
  ('مستوى نظام'), ('تطور'), ('قوة النظام'), ('حب'), ('عاطفي'),
  ('هارم'), ('عكس الهارم'), ('حياة مدرسية'), ('زواج'),
  ('حب مثلثي'), ('حب مستحيل'), ('حب نقي'), ('رومانسية تاريخية'),
  ('بالغين'), ('إتشي'), ('هنتاي'), ('سينين'), ('جوسي'), ('نضج'),
  ('محتوى جنسي'), ('تراجيديا'), ('دموع'), ('عائلة'), ('صداقة'),
  ('علاقات'), ('اجتماعي'), ('سياسي'), ('اقتصادي'),
  ('كوميديا رومانسية'), ('محاكاة ساخرة'), ('فكاهة'),
  ('كوميديا سوداء'), ('مزاح'), ('رعب نفسي'), ('ظلام'), ('غوري'),
  ('بقاء'), ('زومبي'), ('شياطين'), ('مصاصي دماء'), ('أشباح'),
  ('جرائم'), ('تحقيقات'), ('بوليسي'), ('مستقبلي'), ('فضاء'),
  ('روبوتات'), ('ذكاء اصطناعي'), ('تكنولوجيا'), ('سايبربانك'),
  ('ستيمبانك'), ('ألعاب'), ('عالم افتراضي'), ('آر بي جي'),
  ('استراتيجية'), ('واقع افتراضي'), ('موهوا'), ('كوري'),
  ('نظام صيادين'), ('انتقام'), ('عودة للماضي'),
  ('بطل قوي من البداية'), ('بطل خافي القوة'), ('صيني'),
  ('زراعة'), ('شيا'), ('ووشيا'), ('زيانشيا'),
  ('فنون قتالية صينية'), ('إمبراطورية'), ('ممالك'),
  ('إمبراطوريات'), ('مملكة'), ('نبلاء'), ('ملوك'), ('أمراء'),
  ('أميرات'), ('بطل قوي'), ('بطل ضعيف يصبح قوي'), ('شرير'),
  ('مناهض للبطولة'), ('عبقري'), ('موهوب'), ('محظوظ'), ('طبخ'),
  ('موسيقى'), ('فن'), ('رقص'), ('غناء'), ('تمثيل'), ('أيدول'),
  ('عارضات أزياء'), ('مانجاكا'), ('كتاب'), ('مؤلف'), ('أعمال'),
  ('مكتب'), ('عمل'), ('طبيب'), ('محامي'), ('معلم'), ('شرطة'),
  ('محقق'), ('يومياتني'), ('4-كوما'), ('دوجينشي'), ('ون شوت'),
  ('ويبتون'), ('مانهوا'), ('مانغوا')
ON CONFLICT (name) DO NOTHING;

-- Create index for faster searches
CREATE INDEX IF NOT EXISTS idx_genres_name ON public.genres(name);